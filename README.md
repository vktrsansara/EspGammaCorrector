# ESP8266 Dynamic Gamma Correction Library

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Простая и легковесная библиотека для применения гамма-коррекции к светодиодам (WS2812B, NeoPixel и др.) на платформе ESP8266.

Ключевая особенность — **динамическое создание таблицы коррекции**, что позволяет изменять значение гаммы "на лету", без необходимости перекомпиляции кода.

## В чем преимущество этого подхода?

Светодиоды имеют нелинейную зависимость между значением ШИМ (0-255) и воспринимаемой яркостью. Например, значение 128 не выглядит как 50% от максимальной яркости, а гораздо тусклее. Гамма-коррекция исправляет это, делая градиенты плавными и естественными для человеческого глаза.

**Стандартный подход:**
Обычно для ускорения процесса используют заранее вычисленную таблицу (Lookup Table, LUT), зашитую в коде. Это быстро и экономит оперативную память (RAM), так как таблица хранится во флеш-памяти (PROGMEM). Однако, если вы захотите изменить коэффициент гаммы, вам придется редактировать код и перепрошивать устройство.

**Подход этой библиотеки (Динамический):**
Эта библиотека создает таблицу гамма-коррекции в оперативной памяти (RAM) при запуске или по команде.

**Преимущества:**
1.  **Гибкость:** Вы можете изменить значение гаммы в любой момент работы программы, вызвав метод `begin(new_gamma_value)`. Это идеально для интерактивных проектов, где нужно настраивать "сочность" картинки через веб-интерфейс, физический регулятор или в зависимости от внешних условий.
2.  **Простота:** Не нужно заранее генерировать таблицы на компьютере и вставлять их в код.

**Компромисс:**
За эту гибкость мы платим небольшим объемом оперативной памяти (~256 байт), который занимается под таблицу. Для ESP8266 с его ~80 КБ RAM это, как правило, не является проблемой.

## Установка

1.  Скачайте этот репозиторий как ZIP-архив (`Code` -> `Download ZIP`).
2.  В Arduino IDE перейдите в `Скетч` -> `Подключить библиотеку` -> `Добавить .ZIP библиотеку...`
3.  Выберите скачанный ZIP-файл.

## Как использовать

```cpp
#include <Adafruit_NeoPixel.h>
#include "GammaCorrector.h" // Подключаем библиотеку

// Создаем глобальный объект нашего класса
GammaCorrector gamma; 

void setup() {
  // Инициализируем таблицу с нужным значением гаммы (2.8 - хороший выбор для LED)
  gamma.begin(2.8); 
}

void loop() {
  // Вместо strip.setPixelColor(n, r, g, b);
  // используем наш метод для получения скорректированного цвета
  
  uint8_t red = 128; // Линейное значение
  uint32_t correctedColor = gamma.correct(red, 0, 0);
  
  strip.setPixelColor(0, correctedColor);
  strip.show();

  // ... в какой-то момент мы можем захотеть изменить гамму
  // gamma.begin(1.8); // Таблица будет пересчитана с новым значением
}
```

## API

*   `GammaCorrector()` - Конструктор.
*   `~GammaCorrector()` - Деструктор, автоматически освобождает память.
*   `void begin(float gammaValue = 2.8)` - Создает или пересчитывает таблицу коррекции с указанным значением гаммы.
*   `uint8_t correct(uint8_t value)` - Корректирует один 8-битный канал.
*   `uint32_t correct(uint8_t r, uint8_t g, uint8_t b)` - Корректирует три канала и возвращает готовое 32-битное значение цвета.